<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simplify Money AI Workflow</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }

        .chat-message {
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            max-width: 80%;
        }

        .user-message {
            background-color: #e2e8f0;
            align-self: flex-end;
            text-align: right;
        }

        .ai-message {
            background-color: #ffffff;
            align-self: flex-start;
            text-align: left;
        }

        .button-primary {
            background-color: #4a90e2;
            color: white;
            font-weight: bold;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .button-primary:hover {
            transform: translateY(-2px);
        }

        .gold-button {
            background-color: #FFD700;
            color: black;
            font-weight: bold;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
            margin-top: 1rem;
        }

        .gold-button:hover {
            transform: scale(1.05);
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #4a90e2;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="bg-white rounded-3xl shadow-2xl p-8 max-w-lg w-full flex flex-col items-center">
        <h1 class="text-3xl font-bold mb-6 text-gray-800">Simplify Money AI</h1>
        <div id="chat-window"
            class="w-full h-80 overflow-y-auto p-4 mb-4 bg-gray-50 rounded-2xl border border-gray-200 flex flex-col space-y-4">
            <div class="chat-message ai-message shadow-sm">
                Hello! I am Kuber AI. How can I assist you with your gold investment questions today?
            </div>
        </div>
        <div class="w-full">
            <input type="text" id="user-question" placeholder="Ask about gold investments..."
                class="w-full p-3 mb-4 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <button id="send-btn" class="w-full button-primary">Ask Kuber AI</button>
        </div>
        <div id="status-message" class="mt-4 text-center font-medium text-gray-600"></div>
        <div id="purchase-section" class="mt-4 hidden flex flex-col items-center w-full">
            <button id="purchase-btn" class="gold-button">Buy â‚¹10 of Digital Gold</button>
            <div id="purchase-status" class="mt-4 text-center text-sm font-semibold text-gray-700"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sendBtn = document.getElementById('send-btn');
            const purchaseBtn = document.getElementById('purchase-btn');
            const userQuestionInput = document.getElementById('user-question');
            const chatWindow = document.getElementById('chat-window');
            const statusMessage = document.getElementById('status-message');
            const purchaseSection = document.getElementById('purchase-section');
            const purchaseStatus = document.getElementById('purchase-status');

            // A dummy user ID for the purpose of this assignment
            const USER_ID = "parag_chief_technologist_001";

            // Function to append a message to the chat window
            function appendMessage(sender, message) {
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('chat-message', sender === 'user' ? 'user-message' : 'ai-message', 'shadow-sm');
                messageDiv.textContent = message;
                chatWindow.appendChild(messageDiv);
                chatWindow.scrollTop = chatWindow.scrollHeight; // Auto-scroll to the bottom
            }

            // Event listener for the "Ask Kuber AI" button
            sendBtn.addEventListener('click', async () => {
                const question = userQuestionInput.value.trim();
                if (!question) {
                    statusMessage.textContent = 'Please enter a question.';
                    return;
                }

                appendMessage('user', question);
                userQuestionInput.value = '';
                purchaseSection.classList.add('hidden'); // Hide purchase button when new question is asked

                // Show a loading spinner
                statusMessage.innerHTML = '<div class="flex items-center justify-center space-x-2"><div class="spinner"></div><span>Kuber AI is thinking...</span></div>';

                try {
                    const response = await fetch('/ask_kuber', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ question: question })
                    });
                    const data = await response.json();

                    if (data.error) {
                        throw new Error(data.error);
                    }

                    appendMessage('ai', data.answer);
                    statusMessage.textContent = '';
                    purchaseSection.classList.remove('hidden'); // Show purchase button after AI response

                } catch (error) {
                    statusMessage.textContent = `Error: ${error.message}`;
                    console.error('Error:', error);
                }
            });

            // Event listener for the "Buy Digital Gold" button
            purchaseBtn.addEventListener('click', async () => {
                purchaseStatus.textContent = 'Processing your purchase...';

                try {
                    const response = await fetch('/purchase_digital_gold', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ user_id: USER_ID })
                    });
                    const data = await response.json();

                    if (data.error) {
                        throw new Error(data.error);
                    }

                    purchaseStatus.textContent = `Success! Transaction ID: ${data.transaction_id || 'N/A'}`;
                    alert(`Purchase successful! Your digital gold has been credited to your account.
Please check your MongoDB database to see the new entry.`);

                } catch (error) {
                    purchaseStatus.textContent = `Error: ${error.message}`;
                    console.error('Error:', error);
                }
            });
        });
    </script>
</body>

</html>